(function($){var browserType,textrange={get:function(property){return _textrange[browserType].get.apply(this,[property])},set:function(start,length){var s=parseInt(start),l=parseInt(length),e;if(typeof start==="undefined"){s=0}else if(start<0){s=this.val().length+s}if(typeof length==="undefined"){e=this.val().length}else if(length>=0){e=s+l}else{e=this.val().length+l}_textrange[browserType].set.apply(this,[s,e]);return this},setcursor:function(position){return this.textrange("set",position,0)},replace:function(text){_textrange[browserType].replace.apply(this,[text]);return this},insert:function(text){return this.textrange("replace",text)}},_textrange={xul:{get:function(property){var props={position:this[0].selectionStart,start:this[0].selectionStart,end:this[0].selectionEnd,length:this[0].selectionEnd-this[0].selectionStart,text:this.val().substring(this[0].selectionStart,this[0].selectionEnd)};return typeof property==="undefined"?props:props[property]},set:function(start,end){this[0].selectionStart=start;this[0].selectionEnd=end},replace:function(text){var start=this[0].selectionStart;this.val(this.val().substring(0,this[0].selectionStart)+text+this.val().substring(this[0].selectionEnd,this.val().length));this[0].selectionStart=start;this[0].selectionEnd=start+text.length}},msie:{get:function(property){var range=document.selection.createRange();if(typeof range==="undefined"){return{position:0,start:0,end:this[0].val().length,length:this[0].val().length,text:this.val()}}var rangetext=this[0].createTextRange();var rangetextcopy=rangetext.duplicate();rangetext.moveToBookmark(range.getBookmark());rangetextcopy.setEndPoint("EndToStart",rangetext);return{position:rangetextcopy.text.length,start:rangetextcopy.text.length,end:rangetextcopy.text.length+range.text.length,length:range.text.length,text:range.text}},set:function(start,end){var range=this[0].createTextRange();if(typeof range==="undefined"){return this}if(typeof start!=="undefined"){range.moveStart("character",start);range.collapse()}if(typeof end!=="undefined"){range.moveEnd("character",end-start)}range.select()},replace:function(text){document.selection.createRange().text=text}}};$.fn.textrange=function(method){if(typeof browserType==="undefined"){browserType="selectionStart"in this[0]?"xul":document.selection?"msie":"unknown"}if(browserType==="unknown"){return this}if(document.activeElement!==this[0]){this[0].focus()}if(typeof method==="undefined"||typeof method!=="string"){return textrange.get.apply(this)}else if(typeof textrange[method]==="function"){return textrange[method].apply(this,Array.prototype.slice.call(arguments,1))}else{$.error("Method "+method+" does not exist in jQuery.textrange")}}})(jQuery);